<!DOCTYPE html>
<html>

<body>

  <script>
    console.log(Math.random())


    let scene = 0;
    let state = "playing"

    let firstSceneCountDown = 0;
    const firstSceneCountDownMax = 3

    let birdX = 0;
    let birdY = 5;
    let birdV = 0;
    const birdR = .25
    const birdSpeed = 1

    let deathTimeout = 0;
    const maxDeathTimeout = 1

    let pipes = []
    const timeBetweenPipes = 3;
    let lastPipeTime = timeBetweenPipes;
    const pipeSpawnX = 5
    const pipeOpening = 4
    const pipeRadius = .5

    let hadstart = false

    scenes = [
      {
        start() {
          firstSceneCountDown = 0
          bootOptions()
        },
        customUpdate() {
          if (!hadstart) {
            hadstart = true;
            start();
            return
          }
          firstSceneCountDown += o.secondsBetweenFrames;
          if (firstSceneCountDown >= firstSceneCountDownMax) {
            changeScene(1)
            hadstart = false
          }
        },
        drawUI() {
          $$.fi("Green").fo("40px Arial").tc("Welcome to this Game", c.canvas.width / 2, c.canvas.height / 2)

        }
      },
      {
        start() {

          pipes = []
          birdX = 0
          birdY = 5
          birdV = 0
          state = "playing"
          lastPipeTime = timeBetweenPipes
          deathTimeout = 0

          o.drawGrid = true;
          o.drawGridInFront = true
          o.fillColor = "cyan"
          o.disableCameraMovement = true;
          zoom(10).lookAt(0, 5);
        },
        customUpdate() {
          if (!hadstart) {
            hadstart = true;
            start();
            return
          }
          if (state == "playing") {
            birdV -= 9.8 * o.time; // Apply the downwad force of gravity
            i.down(" ", () => birdV = 5)
            birdY += birdV * o.time;
            birdX += o.time * birdSpeed;
            lookAt(birdX, 5);
            if (birdY - birdR <= 0 || birdY + birdR >= 10) {
              //You hit the ground or the top
              state = "dying"
            }

            lastPipeTime += o.secondsBetweenFrames;
            if (lastPipeTime >= timeBetweenPipes) {
              lastPipeTime = 0;
              let middle = Math.random() * 6 + 2;
              let gap = 4;
              addPipes(middle, gap, pipeSpawnX + birdX)
            }

            for (const pipe of pipes) {
              if (collisionRectRect(birdX, birdY, birdR, birdR, pipe.x, pipe.y, pipe.rx, pipe.ry)) {
                state = "dying"

              }
            }
          }
          if (state != "playing") {
            deathTimeout += o.secondsBetweenFrames;
            let percent = Math.min(1, 2 * deathTimeout / (1 * maxDeathTimeout))
            zoom(interp(percent, 10, 1))
              .lookAt(birdX, interp(percent, 5, birdY))
            if (deathTimeout >= maxDeathTimeout) {
              changeScene(0)
              hadstart = false;
            }
          }
        },
        draw() {
          $$.fi(state == "playing" ? "blue" : "red").fillRectCentered(birdX, birdY, birdR, birdR)
          for (let pipe of pipes) {
            $$.fi("green").fillRectCentered(pipe.x, pipe.y, pipe.rx, pipe.ry)
          }
        }
      }
    ]







    function addPipes(middle, gap, x) {
      let pipe = {}
      pipe.startX = x;
      pipe.startY = 10;
      pipe.startRX = pipeRadius;
      pipe.startRY = 10 - middle - gap / 2;
      pipe.x = pipe.startX;
      pipe.y = pipe.startY
      pipe.rx = pipe.startRX;
      pipe.ry = pipe.startRY;
      pipes.push(pipe)

      pipe = {}
      pipe.startX = x;
      pipe.startY = 0;
      pipe.startRX = pipeRadius;
      pipe.startRY = middle - gap / 2;
      pipe.x = pipe.startX;
      pipe.y = pipe.startY
      pipe.rx = pipe.startRX;
      pipe.ry = pipe.startRY;
      pipes.push(pipe)
    }


  </script>
  <script src="./../game.js"></script>

</body>

</html>